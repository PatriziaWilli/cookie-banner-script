(()=>{(function(){let g=document.currentScript,p=g.dataset.siteId,y=g.dataset.token,k="cookie_consent";if(!p||!y)return;let h=`https://brave-connection-f862697dcf.strapiapp.com/api/clients/${p}?populate=cookies`,a=[],E=[];function b(){let t=document.cookie.match(new RegExp("(^| )"+k+"=([^;]+)"));if(t)try{let e=JSON.parse(decodeURIComponent(t[2]));return console.log("Leggo cookie_consent:",e),e}catch{return console.warn("Errore parsing cookie_consent"),null}return console.log("cookie_consent non trovato"),null}function f(t){console.log("Scrivo cookie_consent con:",t);let e=encodeURIComponent(JSON.stringify(t)),n=new Date;n.setFullYear(n.getFullYear()+1),document.cookie=`${k}=${e};expires=${n.toUTCString()};path=/;SameSite=Lax`}function v(t){document.querySelectorAll(`script[data-cookie-placeholder="${t}"]`).forEach(e=>{if(e.dataset.loaded==="true")return;let n=document.createElement("script");e.src&&(n.src=e.src),e.async&&(n.async=!0),e.defer&&(n.defer=!0),e.textContent&&(n.textContent=e.textContent),e.dataset.loaded="true",e.parentNode.replaceChild(n,e)})}function C(t){document.querySelectorAll(`script[data-cookie-category="${t}"]`).forEach(e=>e.parentNode.removeChild(e))}function u(t){a.forEach(e=>{t.includes(e)?v(e):e!=="essential"&&C(e)})}function m(){let t=document.getElementById("cookie-settings-button");t?t.style.display="block":(t=document.createElement("button"),t.id="cookie-settings-button",t.textContent="Modifica preferenze cookie",Object.assign(t.style,{position:"fixed",bottom:"15px",right:"15px",zIndex:"10000",background:"#222",color:"white",border:"none",padding:"10px 15px",borderRadius:"5px",cursor:"pointer",fontFamily:"Arial, sans-serif",fontSize:"14px",boxShadow:"0 2px 6px rgba(0,0,0,0.3)"}),t.onclick=x,document.body.appendChild(t))}function S(t){E=t,a=[...new Set(t.map(s=>s.category))],a.includes("essential")||a.unshift("essential");let e=document.getElementById("cookie-settings-button");e&&(e.style.display="none");let n=document.getElementById("cookie-banner");n&&n.remove();let o=document.createElement("div");o.id="cookie-banner",Object.assign(o.style,{position:"fixed",bottom:"0",left:"0",right:"0",background:"#222",color:"white",padding:"15px",fontFamily:"Arial, sans-serif",zIndex:"9999",display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"});let l=document.createElement("div");l.innerText="Questo sito usa cookie. Gestisci le tue preferenze.";let d=document.createElement("div"),r=document.createElement("button");r.innerText="Accetta tutti",r.style.marginRight="10px",r.onclick=()=>{f(a),u(a),o.remove(),m()};let i=document.createElement("button");i.innerText="Rifiuta non essenziali",i.style.marginRight="10px",i.onclick=()=>{f(["essential"]),u(["essential"]),o.remove(),m()};let c=document.createElement("button");c.innerText="Personalizza",c.onclick=x,d.append(r,i,c),o.append(l,d),document.body.appendChild(o)}function x(){let t=document.getElementById("cookie-banner");t&&t.remove();let e=document.getElementById("cookie-settings-button");e&&(e.style.display="none");let n=b()||["essential"],o=document.createElement("div");o.id="cookie-banner",Object.assign(o.style,{position:"fixed",bottom:"0",left:"0",right:"0",background:"#222",color:"white",padding:"15px",fontFamily:"Arial, sans-serif",zIndex:"9999"});let l=document.createElement("div");l.innerText="Seleziona le categorie di cookie che accetti:",l.style.marginBottom="10px";let d=document.createElement("form");a.forEach(i=>{let c=document.createElement("label");c.style.display="block",c.style.marginBottom="5px";let s=document.createElement("input");s.type="checkbox",s.name="cookie-category",s.value=i,s.disabled=i==="essential",s.checked=i==="essential"||n.includes(i),c.append(s,document.createTextNode(" "+i)),d.append(c)});let r=document.createElement("button");r.type="submit",r.innerText="Salva preferenze",r.style.marginTop="10px",d.append(r),o.append(l,d),document.body.appendChild(o),d.onsubmit=i=>{i.preventDefault();let c=Array.from(d.elements["cookie-category"]).filter(s=>s.checked).map(s=>s.value);c.includes("essential")||c.unshift("essential"),f(c),u(c),o.remove(),m()}}fetch(h).then(t=>t.json()).then(t=>{let e=t.data;if(!e){console.warn("Client non trovato nella risposta");return}if(e.token!==y){console.warn("Client non autorizzato o token errato.");return}let n=e.cookies||[];console.log("\u2705 Banner attivato per:",p,"\u{1F4E6} Cookies:",n),a=[...new Set(n.map(l=>l.category))],a.includes("essential")||a.unshift("essential");let o=b();o?(u(o),m()):S(n)}).catch(t=>console.error("Errore di fetch:",t))})();})();
